# 谈谈你对数据库事务ACID的理解？

## 1.ACID分别是什么？

太常见的面试题，建议一定要记一下单词。

### 1.1 A（Atomicity） 原子性

- 事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。
- 事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。
- 反正记住，原子性就是强调事务是一个整体。你翻译成整体性，我觉得也不是不可以。

### 1.2 C（Consistency） 一致性

- 一致性是指事务执行前后，数据处于一种合法的状态，也就是整个事务执行下来，是你要的结果，是正确的结果。所以我觉得这个东西叫正确性也可以。
- 一致性，我觉得是业务层面的一种要求。你对数据库进行操作，你当然希望操作的结果符合你的预期，是可靠的。实际上ACID中，AID都是为了实现这个C，与其说C是性质，还不如说C是最终目的。

### 1.3 I（Isolation） 隔离性

- 首先要记住，隔离性，是出于并发的需要。
- 如果你的数据库是神级数据库，一次只能执行一个事务，那你的数据库就实现了完美的隔离性，因为没有并发，就没有并发问题。
- 隔离性是指多个事务并发执行的时候，事务内部的操作与其他事务是隔离的，并发执行的各个事务之间不能互相干扰。
- 隔离性也是ACID中最常考的。从情景模拟，到实现原理，都要深究。

### 1.3 D（Durability） 持久性

- 持久性是指事务一旦提交，它对数据库的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。
- 在业务上，你提交了事务，当然是希望你的事务能够正常改变数据，而且这个结果是能保持的。不能说过一会你的提交根本没有生效，或者正常提交之后又回滚了。

## 2.如果没有ACID，会发生什么？

最简单的场景，就是转账，从A账户转账50元到B账户。我们探讨一下，如果失去ACID中任一性质，会发生什么。

正常的一个事务：

|  事务1   | 
|  ----  | 
| 事务开始 | 
| 从磁盘上把A账户余额读取到内存的变量A中 |
| 执行操作：A = A - 50 |
| 把内存中的变量A写回磁盘 |
| 从磁盘上把B账户余额读取到内存的变量B中 |
| 执行操作：B = B + 50 |
| 把内存中的变量B写回磁盘 |
| 事务提交 | 

### 2.1 失去A

#### 2.1.1 事务中途出错，依然能够提交

|  事务1   | 
|  ----  |
| 事务开始 |
| 从磁盘上把A账户余额读取到内存的变量A中 |
| 执行操作：A = A - 50 |
| 把内存中的变量A写回磁盘 |
| -------- 芜湖，没了！|
| 事务提交 | 

A平白无故少了50块钱，B没收到钱。

#### 2.1.2 事务中途出现了错误，之前的操作不回滚

|  事务1   | 
|  ----  | 
| 从磁盘上把A账户余额读取到内存的变量A中 |
| 执行操作：A = A - 50 |
| 把内存中的变量A写回磁盘 |
| 从磁盘上把B账户余额读取到内存的变量B中 |
| 执行操作：B = B + 50 |
| -------- 芜湖，程序报了个错！|
| 把内存中的变量B写回磁盘 |
| 事务提交 | 

虽然整个转账完成了，但是结果是错误的。
