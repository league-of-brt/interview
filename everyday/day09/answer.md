# 谈谈MySQL中的聚集索引、非聚集索引

## 常见问题
1. 使用MySQL InnoDB时都会设置一个主键，及时建表时不指定主键，MySQL也会自动隐式地创建主键，那么主键有什么用呢 
2. 为什么一张表只能有一个主键（聚集索引） 
3. 为什么推荐使用自增主键  
4. 为什么使用主键查询数据效率高

TODO  

## 聚集索引
定义：聚集索引指数据库表行中数据的物理顺序与键值的逻辑（索引）顺序相同  

在InnoDB中：     
1、聚集索引就是按照每张表的主键构造一颗B+树（后面再学习一波），同时叶子节点中存放行记录数据（因此叶子节点称为数据页） 
2、表是根据主键顺序组织存放的（索引组织表），所以每张表都有一个主键 
所以要满足这两个前提，索引组织表中数据也是索引的一部分（通俗的理解：主键中包含行记录数据）  

看到这里，需要补习InnoDB数据存储结构、B+树  

### 1. 使用MySQL InnoDB时都会设置一个主键，及时建表时不指定主键，MySQL也会自动隐式地创建主键，那么主键有什么用呢  
1.1 建表指定主键 -> 第一个定义的非空唯一索引 -> InnoDB隐式创建一个6字节的指作为主键  
1.2 由于InnoDB的存储特性（索引组织表），所以每张表必须要有一个主键，没有时引擎隐式处理

### 2. 为什么一张表只能有一个主键（聚集索引） 
由于聚集索引是B+树结构、索引组织表特性，一张表不可能同时根据不同主键（列）生成不同的B+树，所以只能一个主键  


### 3. 为什么推荐使用自增主键  
   root
   /  \
page1  page2 

数据页与页之间存在双向指针（page1的下一页指向page2，page2上一页指向page1），类似链表结构  
当主键为自增id时，假设page1中存放（id=1、2、3...10）数据，page2中存放（id=11、12、13...20），数据当前id=20，当插入下一条数据时，主键已经有序，直接申请page3存放  
但当主键不为自增id时，假设page1中存放（id=a、b、c...g）数据，page2中存放（id=h、i、j...n），当插入下一条数据时，id=cc，那么此时需要移动id=c后面的数据（假定abc排序，保证有序就行）  
这种情况下，插入性能效率差异就出来了


### 4. 为什么使用主键查询数据效率高
B+树、索引组织表特性可解释（待对比非聚集索引）


## 非聚集索引
定义： 一种索引类型，该索引中索引的逻辑顺序与磁盘上行的物理存储顺序不同  

在InnoDB中：  
非聚集索引指主键以外的其他索引，默认使用B+树，叶子节点不包含行记录数据，而是包含bookmark（一行或多行的数据指向）  

TODO 查询示例


